<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Interactive Page with AI Agent</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <main>
      <div id="nav" class="navbar">
        <a href="#home" onclick="setActive('home')">Home</a>
        <a href="#services" onclick="setActive('services')">Services</a>
        <a href="#about" onclick="setActive('about')">About</a>
        <a href="#contact" onclick="setActive('contact')">Contact</a>
      </div>
      <div class="sidebar" id="sidebar">
        <!-- Sidebar content will be injected here based on the active navbar item -->
      </div>
      <div class="content" id="content">
        <!--  Content will be injected here based on the active sidebar item -->
        <!-- script-->
      </div>
    </main>
    <div class="branch" style="top: 100px"></div>
    <div class="branch" style="top: 200px"></div>
    <div class="branch" style="top: 300px"></div>
    <div class="branch" style="top: 400px"></div>
    <div class="branch" style="top: 500px"></div>
    <div class="branch" style="top: 600px"></div>
    <div class="branch" style="top: 700px"></div>
    <div class="branch" style="top: 800px"></div>
    <div class="agent" id="agentDiv"></div>
    <style id="component-styles"></style>
    <canvas id="myCanvas"></canvas>
    <script>
      const domParser = new DOMParser();
      let run;

      async function setActive(section) {
        document
          .querySelectorAll(".navbar a")
          .forEach((a) => a.classList.remove("active"));
        document
          .querySelector(`.navbar a[href="#${section}"]`)
          .classList.add("active");

        const component = await fetch(`/xpontents/${section}/${section}.html`);
        const [styles, sidebar, content, script] = (
          await component.text()
        ).split("&brvbar;");

        const doc = domParser.parseFromString(styles, "text/html");
        const componentStyles = doc.getElementById("component-styles");
        document.getElementById("component-styles").remove();
        document.body.appendChild(componentStyles);

        const parsed = script.replace("<script>", "").replace("<\/script>", "");
        const scr = document.createElement("script");
        scr.id = "component-script";
        scr.textContent = parsed;

        document.getElementById("sidebar").innerHTML = sidebar;
        const contentArea = document.getElementById("content");

        contentArea.innerHTML = content;
        document.getElementById("component-script")?.remove();
        document.body.appendChild(componentStyles);
        contentArea.appendChild(scr);

        run();
      }
      setActive("home");
    </script>
    <script type="module">
      import { Agent } from "./src/agent.js";
      const targets = [...document.querySelectorAll("main *")].sort(
        () => Math.random() - 0.5
      );
      let currentIndex = 0;
      const agent = new Agent(agentDiv, targets);
    </script>
  </body>
</html>
